int scsi_req_get_sense(SCSIRequest *req, uint8_t *buf, int len) int ret ; if ( ! req -> sense_len )  ret = scsi_build_sense ( req -> sense , req -> sense_len , buf , len , true ); int scsi_build_sense(uint8_t *in_buf, int uint8_t *buf, int len, bool fixed) bool fixed_in ; if ( ! fixed && len < 8 )  if ( in_len == 0 )  fixed_in = ( in_buf [ 0 ] & 2 ) == 0; if ( fixed == fixed_in )  memcpy ( buf , in_buf , MIN ( len , in_len ) ); 