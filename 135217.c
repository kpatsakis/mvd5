cgiEnvironmentResultType cgiWriteEnvironment(char *filename) FILE * out ; cgiFormEntry * e ; out = fopen ( filename , "wb" ); if ( ! out )  if ( ! cgiWriteString ( out , "CGIC2.0" ) )  if ( ! cgiWriteString ( out , cgiServerSoftware ) )  if ( ! cgiWriteString ( out , cgiServerName ) )  if ( ! cgiWriteString ( out , cgiGatewayInterface ) )  if ( ! cgiWriteString ( out , cgiServerProtocol ) )  if ( ! cgiWriteString ( out , cgiServerPort ) )  if ( ! cgiWriteString ( out , cgiRequestMethod ) )  if ( ! cgiWriteString ( out , cgiPathInfo ) )  if ( ! cgiWriteString ( out , cgiPathTranslated ) )  if ( ! cgiWriteString ( out , cgiScriptName ) )  if ( ! cgiWriteString ( out , cgiQueryString ) )  if ( ! cgiWriteString ( out , cgiRemoteHost ) )  if ( ! cgiWriteString ( out , cgiRemoteAddr ) )  if ( ! cgiWriteString ( out , cgiAuthType ) )  if ( ! cgiWriteString ( out , cgiRemoteUser ) )  if ( ! cgiWriteString ( out , cgiRemoteIdent ) )  if ( ! cgiWriteString ( out , cgiContentType ) )  if ( ! cgiWriteString ( out , cgiAccept ) )  if ( ! cgiWriteString ( out , cgiUserAgent ) )  if ( ! cgiWriteString ( out , cgiReferrer ) )  if ( ! cgiWriteString ( out , cgiCookie ) )  if ( ! cgiWriteInt ( out , cgiContentLength ) )  static int cgiWriteInt(FILE *out, int i) if ( ! fwrite ( & i , sizeof ( int ) , 1 , out ) )  return 0 ; return 1 ; e = cgiFormEntryFirst; while ( e )  cgiFilePtr fp ; if ( ! cgiWriteString ( out , e -> attr ) )  if ( ! cgiWriteString ( out , e -> value ) )  if ( ! cgiWriteString ( out , e -> fileName ) )  if ( ! cgiWriteString ( out , e -> contentType ) )  if ( ! cgiWriteInt ( out , e -> valueLength ) )  static int cgiWriteInt(FILE *out, int i) if ( ! fwrite ( & i , sizeof ( int ) , 1 , out ) )  return 0 ; return 1 ; if ( cgiFormFileOpen ( e -> attr , & fp ) == cgiFormSuccess )  cgiFormResultType char *name, cgiFilePtr *cfpp) cgiFormEntry * e ; cgiFilePtr cfp ; e = cgiFormEntryFindFirst ( name ); static cgiFormEntry *cgiFormEntryFindFirst(char *name) return cgiFormEntryFindNext ( ) ; static cgiFormEntry *cgiFormEntryFindNext() while ( cgiFindPos )  cgiFormEntry * c = cgiFindPos ; cgiFindPos = c -> next; if ( ! strcmp ( c -> attr , cgiFindTarget ) )  return c ; return 0 ; if ( ! e )  return cgiFormNotFound ; if ( ! strlen ( e -> tfileName ) )  return cgiFormNotAFile ; cfp = ( cgiFilePtr ) malloc ( sizeof ( cgiFile ) ); if ( ! cfp )  return cgiFormMemory ; cfp -> in = fopen ( e -> tfileName , "rb" ); if ( ! cfp -> in )  return cgiFormIO ; return cgiFormSuccess ; char buffer [ 1024 ] ; int got ; if ( ! cgiWriteInt ( out , 1 ) )  static int cgiWriteInt(FILE *out, int i) if ( ! fwrite ( & i , sizeof ( int ) , 1 , out ) )  return 0 ; return 1 ; while ( cgiFormFileRead ( fp , buffer , sizeof ( buffer ) , & got ) == cgiFormSuccess )  cgiFormResultType cgiFilePtr cfp, char int bufferSize, int *gotP) if ( ! cfp )  return cgiFormOpenFailed ; got = fread ( buffer , 1 , bufferSize , cfp -> in ); if ( got <= 0 )  return cgiFormEOF ; return cgiFormSuccess ; if ( ( ( int ) fwrite ( buffer , 1 , got , out ) ) != got )  if ( cgiFormFileClose ( fp ) != cgiFormSuccess )  cgiFormResultType cgiFormFileClose(cgiFilePtr cfp) if ( ! cfp )  return cgiFormOpenFailed ; return cgiFormSuccess ; if ( ! cgiWriteInt ( out , 0 ) )  static int cgiWriteInt(FILE *out, int i) if ( ! fwrite ( & i , sizeof ( int ) , 1 , out ) )  return 0 ; return 1 ; e = e -> next; static int cgiWriteString(FILE *out, char *s) int len = ( int ) strlen ( s ) ; cgiWriteInt ( out , len ); static int cgiWriteInt(FILE *out, int i) if ( ! fwrite ( & i , sizeof ( int ) , 1 , out ) )  if ( ( ( int ) fwrite ( s , 1 , len , out ) ) != len )  