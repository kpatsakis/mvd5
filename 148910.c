static int32_t scsi_target_send_command(SCSIRequest *req, uint8_t *buf) SCSITargetReq * r = DO_UPCAST ( SCSITargetReq , req , req ) ; switch ( buf [ 0 ] )  if ( ! scsi_target_emulate_inquiry ( r ) )  static bool scsi_target_emulate_inquiry(SCSITargetReq *r) if ( r -> req . cmd . buf [ 1 ] & 0x2 )  if ( r -> req . cmd . buf [ 1 ] & 0x1 )  if ( r -> req . cmd . buf [ 2 ] != 0 )  r -> len = MIN ( r -> req . cmd . xfer , SCSI_INQUIRY_LEN ); memset ( r -> buf , 0 , r -> len ); if ( r -> req . lun != 0 )  r -> buf [ 0 ] = TYPE_NOT_PRESENT | TYPE_INACTIVE; r -> buf [ 2 ] = 5; r -> buf [ 3 ] = 2 | 0x10; r -> buf [ 4 ] = r -> len - 5; r -> buf [ 7 ] = 0x10 | ( r -> req . bus -> info -> tcq ? 0x02 : 0 ); memcpy ( & r -> buf [ 8 ] , "QEMU    " , 8 ); memcpy ( & r -> buf [ 16 ] , "QEMU TARGET     " , 16 ); pstrcpy ( ( char * ) & r -> buf [ 32 ] , 4 , qemu_get_version ( ) ); 