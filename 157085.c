static void xhci_detach(USBPort *usbport) XHCIState * xhci = usbport -> opaque ; XHCIPort * port = xhci_lookup_port ( xhci , usbport ) ; static XHCIPort *xhci_lookup_port(XHCIState *xhci, struct USBPort *uport) int index ; if ( ! uport -> dev )  return NULL ; switch ( uport -> dev -> speed )  if ( xhci_get_flag ( xhci , XHCI_FLAG_SS_FIRST ) )  index = uport -> index + xhci -> numports_3; index = uport -> index; if ( xhci_get_flag ( xhci , XHCI_FLAG_SS_FIRST ) )  index = uport -> index; index = uport -> index + xhci -> numports_2; return NULL ; return & xhci -> ports [ index ] ; xhci_port_update ( port , 1 ); static void xhci_port_update(XHCIPort *port, int is_detach) xhci_port_notify ( port , PORTSC_CSC ); static void xhci_port_notify(XHCIPort *port, uint32_t bits) if ( ( port -> portsc & bits ) == bits )  port -> portsc |= bits; if ( ! xhci_running ( port -> xhci ) )  xhci_event ( port -> xhci , & ev , 0 ); static void xhci_event(XHCIState *xhci, XHCIEvent *event, int v) XHCIInterrupter * intr ; dma_addr_t erdp ; unsigned int dp_idx ; if ( v >= xhci -> numintrs )  intr = & xhci -> intr [ v ]; if ( intr -> er_full )  erdp = xhci_addr64 ( intr -> erdp_low , intr -> erdp_high ); if ( erdp < intr -> er_start || erdp >= ( intr -> er_start + TRB_SIZE * intr -> er_size ) )  dp_idx = ( erdp - intr -> er_start ) / TRB_SIZE; assert ( dp_idx < intr -> er_size ); 