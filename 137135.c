enum XML_Status XML_Parse(XML_Parser parser, const char *s, int len, int isFinal) switch ( ps_parsing )  if ( len == 0 )  if ( bufferPtr == bufferEnd )  void * buff = XML_GetBuffer ( parser , len ) ; void * XML_GetBuffer(XML_Parser parser, int len) switch ( ps_parsing )  return NULL ; return NULL ; if ( len > bufferLim - bufferEnd )  int neededSize = len + ( int ) ( bufferEnd - bufferPtr ) ; int keep = ( int ) ( bufferPtr - buffer ) ; if ( keep > XML_CONTEXT_BYTES )  keep = XML_CONTEXT_BYTES; neededSize += keep; if ( neededSize <= bufferLim - buffer )  if ( keep < bufferPtr - buffer )  int offset = ( int ) ( bufferPtr - buffer ) - keep ; bufferEnd -= offset; char * newBuf ; int bufferSize = ( int ) ( bufferLim - bufferPtr ) ; if ( bufferSize == 0 )  bufferSize = INIT_BUFFER_SIZE; bufferSize *= 2; while ( bufferSize < neededSize )  newBuf = ( char * ) MALLOC ( bufferSize ); if ( newBuf == 0 )  return NULL ; if ( bufferPtr )  int keep = ( int ) ( bufferPtr - buffer ) ; if ( keep > XML_CONTEXT_BYTES )  keep = XML_CONTEXT_BYTES; memcpy ( newBuf , & bufferPtr [ - keep ] , bufferEnd - bufferPtr + keep ); buffer = newBuf; bufferEnd = buffer + ( bufferEnd - bufferPtr ) + keep; bufferEnd = newBuf + ( bufferEnd - bufferPtr ); return bufferEnd ; if ( buff == NULL )  memcpy ( buff , s , len ); 