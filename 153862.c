static int32_t scsi_target_send_command(SCSIRequest *req, uint8_t *buf) SCSITargetReq * r = DO_UPCAST ( SCSITargetReq , req , req ) ; switch ( buf [ 0 ] )  if ( ! scsi_target_emulate_report_luns ( r ) )  static bool scsi_target_emulate_report_luns(SCSITargetReq *r) if ( r -> req . cmd . xfer < 16 )  return false ; if ( r -> req . cmd . buf [ 2 ] > 2 )  return false ; return true ; if ( ! scsi_target_emulate_inquiry ( r ) )  static bool scsi_target_emulate_inquiry(SCSITargetReq *r) if ( r -> req . cmd . buf [ 1 ] & 0x2 )  return false ; if ( r -> req . cmd . buf [ 1 ] & 0x1 )  uint8_t page_code = r -> req . cmd . buf [ 2 ] ; switch ( page_code )  return false ; return true ; if ( r -> req . cmd . buf [ 2 ] != 0 )  return false ; return true ; scsi_req_build_sense ( req , SENSE_CODE ( INVALID_FIELD ) ); void scsi_req_build_sense(SCSIRequest *req, SCSISense sense) memset ( req -> sense , 0 , 18 ); req -> sense [ 0 ] = 0x70; req -> sense [ 2 ] = sense . key; req -> sense [ 7 ] = 10; req -> sense [ 12 ] = sense . asc; req -> sense [ 13 ] = sense . ascq; req -> sense_len = 18; 