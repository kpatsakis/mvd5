static long vhost_scsi_compat_ioctl(struct file *f, unsigned int unsigned long arg) return vhost_scsi_ioctl ( f , ioctl , ( unsigned long ) compat_ptr ( arg ) ) ; static vhost_scsi_ioctl(struct file unsigned int unsigned long arg) struct vhost_scsi * vs = f -> private_data ; struct vhost_scsi_target backend ; void __user * argp = ( void __user * ) arg ; switch ( ioctl )  if ( copy_from_user ( & backend , argp , sizeof backend ) )  if ( backend . reserved != 0 )  return vhost_scsi_clear_endpoint ( vs , & backend ) ; static vhost_scsi_clear_endpoint(struct vhost_scsi struct vhost_scsi_target *t) struct tcm_vhost_tport * tv_tport ; struct tcm_vhost_tpg * tpg ; int index , ret , i ; u8 target ; for (index = 0; index < vs->dev.nvqs; ++index) if ( ! vhost_vq_access_ok ( & vs -> vqs [ index ] . vq ) )  if ( ! vs -> vs_tpg )  for (i = 0; i < VHOST_SCSI_MAX_TARGET; i++) target = i; tpg = vs -> vs_tpg [ target ]; if ( ! tpg )  tv_tport = tpg -> tport; if ( ! tv_tport )  if ( strcmp ( tv_tport -> tport_name , t -> vhost_wwpn ) )  tpg -> tv_tpg_vhost_count --; tpg -> vhost_scsi = NULL; vs -> vs_tpg [ target ] = NULL; 