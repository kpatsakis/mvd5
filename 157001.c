unsigned				/* O - Number of bytes read CVE_2014_9679_VULN_cupsRasterReadPixels(cups_raster_t *r,	/* I - Raster stream unsigned char *p,	/* I - Pointer to pixel buffer unsigned      len)	/* I - Number of bytes to read */ int bytes ; unsigned cupsBytesPerLine ; unsigned remaining ; unsigned char * ptr , byte , * temp ; int count ; if ( r == NULL || r -> mode != CUPS_RASTER_READ || r -> remaining == 0 )  if ( ! r -> compressed )  remaining = len; cupsBytesPerLine = r -> header . cupsBytesPerLine; while ( remaining > 0 && r -> remaining > 0 )  if ( r -> count == 0 )  if ( remaining == cupsBytesPerLine )  ptr = p; ptr = r -> pixels; if ( ! cups_raster_read ( r , & byte , 1 ) )  r -> count = byte + 1; if ( r -> count > 1 )  ptr = r -> pixels; temp = ptr; bytes = cupsBytesPerLine; while ( bytes > 0 )  if ( ! cups_raster_read ( r , & byte , 1 ) )  if ( byte & 128 )  count = ( 257 - byte ) * r -> bpp; if ( count > bytes )  count = bytes; if ( ! cups_raster_read ( r , temp , count ) )  temp += count; bytes -= count; count = ( byte + 1 ) * r -> bpp; if ( count > bytes )  count = bytes; if ( count < r -> bpp )  bytes -= count; if ( ! cups_raster_read ( r , temp , r -> bpp ) )  temp += r -> bpp; count -= r -> bpp; while ( count > 0 )  memcpy ( temp , temp - r -> bpp , r -> bpp ); temp += r -> bpp; count -= r -> bpp; if ( remaining >= cupsBytesPerLine )  bytes = cupsBytesPerLine; r -> pcurrent = r -> pixels; r -> count --; r -> remaining --; bytes = remaining; r -> pcurrent = r -> pixels + bytes; if ( ptr != p )  memcpy ( p , ptr , bytes ); if ( ( bytes = r -> pend - r -> pcurrent ) > remaining )  bytes = remaining; memcpy ( p , r -> pcurrent , bytes ); r -> pcurrent += bytes; if ( r -> pcurrent >= r -> pend )  r -> pcurrent = r -> pixels; r -> count --; r -> remaining --; remaining -= bytes; p += bytes; 