int CVE_2012_2669_VULN_main(void) int fd , len , sock_opt ; struct cn_msg * message ; struct nlmsghdr * incoming_msg ; struct cn_msg * incoming_cn_msg ; struct hv_kvp_msg * hv_msg ; fd = socket ( AF_NETLINK , SOCK_DGRAM , NETLINK_CONNECTOR ); message = ( struct cn_msg * ) kvp_send_buffer; message -> id . idx = CN_KVP_IDX; message -> id . val = CN_KVP_VAL; hv_msg = ( struct hv_kvp_msg * ) message -> data; hv_msg -> kvp_hdr . operation = KVP_OP_REGISTER; message -> ack = 0; message -> len = sizeof ( struct hv_kvp_msg ); len = netlink_send ( fd , message ); while ( 1 )  len = recv ( fd , kvp_recv_buffer , sizeof ( kvp_recv_buffer ) , 0 ); if ( len < 0 )  incoming_msg = ( struct nlmsghdr * ) kvp_recv_buffer; incoming_cn_msg = ( struct cn_msg * ) NLMSG_DATA ( incoming_msg ); hv_msg = ( struct hv_kvp_msg * ) incoming_cn_msg -> data; switch ( hv_msg -> kvp_hdr . operation )  incoming_cn_msg -> id . idx = CN_KVP_IDX; incoming_cn_msg -> id . val = CN_KVP_VAL; incoming_cn_msg -> ack = 0; incoming_cn_msg -> len = sizeof ( struct hv_kvp_msg ); len = netlink_send ( fd , incoming_cn_msg ); if ( len < 0 )  syslog ( LOG_ERR , "net_link send failed; error:%d" , len ); 