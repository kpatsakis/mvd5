status_t MPEG4Source::parseSampleAuxiliaryInformationOffsets(off64_t offset, off64_t size) if ( mCurrentSamples . IsEmpty ( ) )  uint8_t version ; if ( mDataSource -> readAt ( offset , & version , sizeof ( version ) ) != 1 )  offset ++; uint32_t flags ; if ( ! mDataSource -> getUInt24 ( offset , & flags ) )  offset += 3; if ( flags & 1 )  offset += 8; uint32_t entrycount ; if ( ! mDataSource -> getUInt32 ( offset , & entrycount ) )  offset += 4; if ( entrycount > mCurrentSampleInfoOffsetsAllocSize )  mCurrentSampleInfoOffsets = ( uint64_t * ) realloc ( mCurrentSampleInfoOffsets , entrycount * 8 ); for (size_t i = 0; i < entrycount; i++) if ( version == 0 )  uint32_t tmp ; if ( ! mDataSource -> getUInt32 ( offset , & tmp ) )  mCurrentSampleInfoOffsets [ i ] = tmp; offset += 4; uint64_t tmp ; if ( ! mDataSource -> getUInt64 ( offset , & tmp ) )  mCurrentSampleInfoOffsets [ i ] = tmp; offset += 8; off64_t drmoffset = mCurrentSampleInfoOffsets [ 0 ] ; drmoffset += mCurrentMoofOffset; int ivlength ; for (size_t i = 0; i < mCurrentSampleInfoCount; i++) Sample * smpl = & mCurrentSamples [ i ] ; memset ( smpl -> iv , 0 , 16 ); if ( mDataSource -> readAt ( drmoffset , smpl -> iv , ivlength ) != ivlength )  drmoffset += ivlength; int32_t smplinfosize = mCurrentDefaultSampleInfoSize ; if ( smplinfosize == 0 )  smplinfosize = mCurrentSampleInfoSizes [ i ]; if ( smplinfosize > ivlength )  uint16_t numsubsamples ; if ( ! mDataSource -> getUInt16 ( drmoffset , & numsubsamples ) )  drmoffset += 2; for (size_t j = 0; j < numsubsamples; j++) uint16_t numclear ; uint32_t numencrypted ; if ( ! mDataSource -> getUInt16 ( drmoffset , & numclear ) )  drmoffset += 2; if ( ! mDataSource -> getUInt32 ( drmoffset , & numencrypted ) )  drmoffset += 4; smpl -> clearsizes . AppendElement ( numclear ); smpl -> encryptedsizes . AppendElement ( numencrypted ); smpl -> clearsizes . AppendElement ( 0 ); smpl -> encryptedsizes . AppendElement ( smpl -> size ); 