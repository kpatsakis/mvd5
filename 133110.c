static void load_firmware_cb(const struct firmware void *context) struct dvb_frontend * fe = context ; int rc ; if ( ! fw )  rc = load_all_firmwares ( fe , fw ); static int load_all_firmwares(struct dvb_frontend const struct firmware *fw) struct xc2028_data * priv = fe -> tuner_priv ; const unsigned char * p , * endp ; int n , n_array ; p = fw -> data; endp = p + fw -> size; if ( fw -> size < sizeof ( name ) - 1 + 2 + 2 )  p += sizeof ( name ) - 1; priv -> firm_version = get_unaligned_le16 ( p ); p += 2; n_array = get_unaligned_le16 ( p ); p += 2; priv -> firm = kcalloc ( n_array , sizeof ( * priv -> firm ) , GFP_KERNEL ); if ( priv -> firm == NULL )  priv -> firm_size = n_array; n = - 1; while ( p < endp )  __u32 type , size ; v4l2_std_id id ; __u16 int_freq = 0 ; n ++; if ( n >= n_array )  if ( endp - p < sizeof ( type ) + sizeof ( id ) + sizeof ( size ) )  type = get_unaligned_le32 ( p ); p += sizeof ( type ); id = get_unaligned_le64 ( p ); p += sizeof ( id ); if ( type & HAS_IF )  int_freq = get_unaligned_le16 ( p ); p += sizeof ( int_freq ); if ( endp - p < sizeof ( size ) )  size = get_unaligned_le32 ( p ); p += sizeof ( size ); if ( ! size || size > endp - p )  priv -> firm [ n ] . ptr = kzalloc ( size , GFP_KERNEL ); if ( priv -> firm [ n ] . ptr == NULL )  priv -> firm [ n ] . type = type; priv -> firm [ n ] . id = id; priv -> firm [ n ] . size = size; priv -> firm [ n ] . int_freq = int_freq; p += size; if ( n + 1 != priv -> firm_size )  free_firmware ( priv ); static void free_firmware(struct xc2028_data *priv) if ( ! priv -> firm )  priv -> firm = NULL; priv -> firm_size = 0; priv -> state = XC2028_NO_FIRMWARE; memset ( & priv -> cur_fw , 0 , sizeof ( priv -> cur_fw ) ); 