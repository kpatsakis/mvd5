static int CVE_2013_1920_VULN_get_free_port(struct domain *d) struct evtchn * chn ; int port ; if ( d -> is_dying )  for ( port = 0; port_is_valid(d, port); port++ ) if ( evtchn_from_port ( d , port ) -> state == ECS_FREE )  if ( port == MAX_EVTCHNS ( d ) )  chn = xmalloc_array ( struct evtchn , EVTCHNS_PER_BUCKET ) if ( unlikely ( chn == NULL ) )  memset ( chn , 0 , EVTCHNS_PER_BUCKET * sizeof ( * chn ) ); bucket_from_port ( d , port ) = chn; if ( xsm_alloc_security_evtchn ( & chn [ i ] ) )  xsm_free_security_evtchn ( & chn [ j ] ); xfree ( chn ); 