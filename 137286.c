status_t MPEG4Extractor::parseMetaData(off64_t offset, size_t size) if ( size < 4 )  FallibleTArray < uint8_t > bufferBackend ; if ( ! bufferBackend . SetLength ( size + 1 , mozilla :: fallible ) )  uint8_t * buffer = bufferBackend . Elements ( ) ; if ( mDataSource -> readAt ( offset , buffer , size ) != ( ssize_t ) size )  uint32_t flags = U32_AT ( buffer ) ; uint32_t metadataKey = 0 ; metadataKey = kKeyAlbum; metadataKey = kKeyArtist; metadataKey = kKeyAlbumArtist; metadataKey = kKeyYear; metadataKey = kKeyTitle; metadataKey = kKeyWriter; metadataKey = kKeyAlbumArt; metadataKey = kKeyGenre; metadataKey = kKeyGenre; buffer [ size ] = '\0'; if ( ( mLastCommentMean . length ( ) != 0 ) && ( mLastCommentName . length ( ) != 0 ) && ( mLastCommentData . length ( ) != 0 ) )  if ( mLastCommentMean == "com.apple.iTunes" && mLastCommentName == "iTunSMPB" )  int32_t delay , padding ; if ( sscanf ( mLastCommentData , " %*x %x %x %*x" , & delay , & padding ) == 2 )  if ( ! mLastTrack )  if ( size >= 8 && metadataKey )  if ( metadataKey == kKeyAlbumArt )  if ( metadataKey == kKeyGenre )  if ( flags == 0 )  int genrecode = ( int ) buffer [ size - 1 ] ; genrecode --; if ( genrecode < 0 )  genrecode = 255; char genre [ 10 ] ; sprintf ( genre , "%d" , genrecode ); mFileMetaData -> setCString ( metadataKey , genre ); 