static int CVE_2013_6380_VULN_aac_send_raw_srb(struct aac_dev* dev, void __user * arg) struct fib * srbfib ; struct user_aac_srb __user * user_srb = arg ; u32 fibsize = 0 ; if ( dev -> in_reset )  if ( ! capable ( CAP_SYS_ADMIN ) )  if ( ! ( srbfib = aac_fib_alloc ( dev ) ) )  srbfib -> hw_fib_va -> header . XferState &= ~cpu_to_le32 ( FastResponseCapable ); srbcmd = ( struct aac_srb * ) fib_data ( srbfib ); if ( copy_from_user ( & fibsize , & user_srb -> count , sizeof ( u32 ) ) )  if ( fibsize > ( dev -> max_fib_size - sizeof ( struct aac_fibhdr ) ) )  user_srbcmd = kmalloc ( fibsize , GFP_KERNEL ); if ( ! user_srbcmd )  if ( copy_from_user ( user_srbcmd , user_srb , fibsize ) )  flags = user_srbcmd -> flags; srbcmd -> function = cpu_to_le32 ( SRBF_ExecuteScsi ); srbcmd -> channel = cpu_to_le32 ( user_srbcmd -> channel ); srbcmd -> id = cpu_to_le32 ( user_srbcmd -> id ); srbcmd -> lun = cpu_to_le32 ( user_srbcmd -> lun ); srbcmd -> timeout = cpu_to_le32 ( user_srbcmd -> timeout ); srbcmd -> flags = cpu_to_le32 ( flags ); srbcmd -> retry_limit = 0; srbcmd -> cdb_size = cpu_to_le32 ( user_srbcmd -> cdb_size ); memcpy ( srbcmd -> cdb , user_srbcmd -> cdb , sizeof ( srbcmd -> cdb ) ); dprintk ( ( KERN_DEBUG "aacraid: too many sg entries %d\n" le32_to_cpu ( srbcmd -> sg . count ) ) ) 