static int CVE_2014_5471_PATCHED_isofs_read_inode(struct inode *inode, int relocated) unsigned long bufsize = ISOFS_BUFFER_SIZE ( inode ) ; unsigned long block ; struct iso_directory_record * de ; unsigned int de_len ; unsigned long offset ; struct iso_inode_info * ei = ISOFS_I ( inode ) ; block = ei -> i_iget5_block; bh = sb_bread ( inode -> i_sb , block ); if ( ! bh )  offset = ei -> i_iget5_offset; de = ( struct iso_directory_record * ) ( bh -> b_data + offset ); de_len = * ( unsigned char * ) de; if ( offset + de_len > bufsize )  int frag1 = bufsize - offset ; tmpde = kmalloc ( de_len , GFP_KERNEL ); if ( tmpde == NULL )  memcpy ( tmpde , bh -> b_data + offset , frag1 ); bh = sb_bread ( inode -> i_sb , ++ block ); if ( ! bh )  memcpy ( ( char * ) tmpde + frag1 , bh -> b_data , de_len - frag1 ); 