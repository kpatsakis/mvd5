int avcodec_decode_audio3(AVCodecContext *avctx,int16_t *samples,int *frame_size_ptr,AVPacket *avpkt) int ret ; if ( avctx -> get_buffer != avcodec_default_get_buffer )  avctx -> get_buffer = avcodec_default_get_buffer; avctx -> release_buffer = avcodec_default_release_buffer; ret = avcodec_decode_audio4 ( avctx , & frame , & got_frame , avpkt ); int avcodec_decode_audio4(AVCodecContext *avctx,AVFrame *frame,int *got_frame_ptr,const AVPacket *avpkt) * got_frame_ptr = 0; if ( ! avpkt -> data && avpkt -> size )  if ( ( avctx -> codec -> type ) != AVMEDIA_TYPE_AUDIO )  if ( avctx -> codec -> capabilities & 0x20 || avpkt -> size )  avctx -> pkt = & tmp; ret = ( ( avctx -> codec -> decode ) ( avctx , frame , got_frame_ptr , & tmp ) ); if ( ret >= 0 && * got_frame_ptr )  avctx -> frame_number ++; frame -> pkt_dts = avpkt -> dts; if ( frame -> format == AV_SAMPLE_FMT_NONE )  frame -> format = ( avctx -> sample_fmt ); if ( ! frame -> channel_layout )  frame -> channel_layout = avctx -> channel_layout; if ( ! frame -> sample_rate )  frame -> sample_rate = avctx -> sample_rate; add_metadata_from_side_data ( avctx , frame ); static int add_metadata_from_side_data(AVCodecContext *avctx,AVFrame *frame) int size ; const uint8_t * side_metadata ; const uint8_t * end ; side_metadata = ( av_packet_get_side_data ( avctx -> pkt , AV_PKT_DATA_STRINGS_METADATA , & size ) ); if ( ! side_metadata )  end = side_metadata + size; while ( side_metadata < end )  const uint8_t * key = side_metadata ; const uint8_t * val = side_metadata + strlen ( key ) + 1 ; int ret = av_dict_set ( ff_frame_get_metadatap ( frame ) , key , val , 0 ) ; if ( ret < 0 )  side_metadata = val + strlen ( val ) + 1; return ret ; 